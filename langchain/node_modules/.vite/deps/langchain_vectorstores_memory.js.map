{
  "version": 3,
  "sources": ["../../@langchain/core/dist/retrievers/index.js", "../../@langchain/core/dist/vectorstores.js", "../../langchain/dist/util/ml-distance/similarities.js", "../../@langchain/core/dist/utils/ml-distance/similarities.js", "../../@langchain/core/dist/utils/math.js", "../../langchain/dist/vectorstores/memory.js"],
  "sourcesContent": ["import { CallbackManager, parseCallbackConfigArg, } from \"../callbacks/manager.js\";\nimport { Runnable } from \"../runnables/base.js\";\nimport { ensureConfig } from \"../runnables/config.js\";\n/**\n * Abstract base class for a document retrieval system, designed to\n * process string queries and return the most relevant documents from a source.\n *\n * `BaseRetriever` provides common properties and methods for derived retrievers,\n * such as callbacks, tagging, and verbose logging. Custom retrieval systems\n * should extend this class and implement `_getRelevantDocuments` to define\n * the specific retrieval logic.\n *\n * @template Metadata - The type of metadata associated with each document,\n *                      defaulting to `Record<string, any>`.\n */\nexport class BaseRetriever extends Runnable {\n    /**\n     * Constructs a new `BaseRetriever` instance with optional configuration fields.\n     *\n     * @param fields - Optional input configuration that can include `callbacks`,\n     *                 `tags`, `metadata`, and `verbose` settings for custom retriever behavior.\n     */\n    constructor(fields) {\n        super(fields);\n        /**\n         * Optional callbacks to handle various events in the retrieval process.\n         */\n        Object.defineProperty(this, \"callbacks\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        /**\n         * Tags to label or categorize the retrieval operation.\n         */\n        Object.defineProperty(this, \"tags\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        /**\n         * Metadata to provide additional context or information about the retrieval\n         * operation.\n         */\n        Object.defineProperty(this, \"metadata\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        /**\n         * If set to `true`, enables verbose logging for the retrieval process.\n         */\n        Object.defineProperty(this, \"verbose\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.callbacks = fields?.callbacks;\n        this.tags = fields?.tags ?? [];\n        this.metadata = fields?.metadata ?? {};\n        this.verbose = fields?.verbose ?? false;\n    }\n    /**\n     * TODO: This should be an abstract method, but we'd like to avoid breaking\n     * changes to people currently using subclassed custom retrievers.\n     * Change it on next major release.\n     */\n    /**\n     * Placeholder method for retrieving relevant documents based on a query.\n     *\n     * This method is intended to be implemented by subclasses and will be\n     * converted to an abstract method in the next major release. Currently, it\n     * throws an error if not implemented, ensuring that custom retrievers define\n     * the specific retrieval logic.\n     *\n     * @param _query - The query string used to search for relevant documents.\n     * @param _callbacks - (optional) Callback manager for managing callbacks\n     *                     during retrieval.\n     * @returns A promise resolving to an array of `DocumentInterface` instances relevant to the query.\n     * @throws {Error} Throws an error indicating the method is not implemented.\n     */\n    _getRelevantDocuments(_query, _callbacks) {\n        throw new Error(\"Not implemented!\");\n    }\n    /**\n     * Executes a retrieval operation.\n     *\n     * @param input - The query string used to search for relevant documents.\n     * @param options - (optional) Configuration options for the retrieval run,\n     *                  which may include callbacks, tags, and metadata.\n     * @returns A promise that resolves to an array of `DocumentInterface` instances\n     *          representing the most relevant documents to the query.\n     */\n    async invoke(input, options) {\n        return this.getRelevantDocuments(input, ensureConfig(options));\n    }\n    /**\n     * @deprecated Use .invoke() instead. Will be removed in 0.3.0.\n     *\n     * Main method used to retrieve relevant documents. It takes a query\n     * string and an optional configuration object, and returns a promise that\n     * resolves to an array of `Document` objects. This method handles the\n     * retrieval process, including starting and ending callbacks, and error\n     * handling.\n     * @param query The query string to retrieve relevant documents for.\n     * @param config Optional configuration object for the retrieval process.\n     * @returns A promise that resolves to an array of `Document` objects.\n     */\n    async getRelevantDocuments(query, config) {\n        const parsedConfig = ensureConfig(parseCallbackConfigArg(config));\n        const callbackManager_ = await CallbackManager.configure(parsedConfig.callbacks, this.callbacks, parsedConfig.tags, this.tags, parsedConfig.metadata, this.metadata, { verbose: this.verbose });\n        const runManager = await callbackManager_?.handleRetrieverStart(this.toJSON(), query, parsedConfig.runId, undefined, undefined, undefined, parsedConfig.runName);\n        try {\n            const results = await this._getRelevantDocuments(query, runManager);\n            await runManager?.handleRetrieverEnd(results);\n            return results;\n        }\n        catch (error) {\n            await runManager?.handleRetrieverError(error);\n            throw error;\n        }\n    }\n}\n", "import { BaseRetriever, } from \"./retrievers/index.js\";\nimport { Serializable } from \"./load/serializable.js\";\n/**\n * Class for retrieving documents from a `VectorStore` based on vector similarity\n * or maximal marginal relevance (MMR).\n *\n * `VectorStoreRetriever` extends `BaseRetriever`, implementing methods for\n * adding documents to the underlying vector store and performing document\n * retrieval with optional configurations.\n *\n * @class VectorStoreRetriever\n * @extends BaseRetriever\n * @implements VectorStoreRetrieverInterface\n * @template V - Type of vector store implementing `VectorStoreInterface`.\n */\nexport class VectorStoreRetriever extends BaseRetriever {\n    static lc_name() {\n        return \"VectorStoreRetriever\";\n    }\n    get lc_namespace() {\n        return [\"langchain_core\", \"vectorstores\"];\n    }\n    /**\n     * Returns the type of vector store, as defined by the `vectorStore` instance.\n     *\n     * @returns {string} The vector store type.\n     */\n    _vectorstoreType() {\n        return this.vectorStore._vectorstoreType();\n    }\n    /**\n     * Initializes a new instance of `VectorStoreRetriever` with the specified configuration.\n     *\n     * This constructor configures the retriever to interact with a given `VectorStore`\n     * and supports different retrieval strategies, including similarity search and maximal\n     * marginal relevance (MMR) search. Various options allow customization of the number\n     * of documents retrieved per query, filtering based on conditions, and fine-tuning\n     * MMR-specific parameters.\n     *\n     * @param fields - Configuration options for setting up the retriever:\n     *\n     *   - `vectorStore` (required): The `VectorStore` instance implementing `VectorStoreInterface`\n     *     that will be used to store and retrieve document embeddings. This is the core component\n     *     of the retriever, enabling vector-based similarity and MMR searches.\n     *\n     *   - `k` (optional): Specifies the number of documents to retrieve per search query. If not\n     *     provided, defaults to 4. This count determines the number of most relevant documents returned\n     *     for each search operation, balancing performance with comprehensiveness.\n     *\n     *   - `searchType` (optional): Defines the search approach used by the retriever, allowing for\n     *     flexibility between two methods:\n     *       - `\"similarity\"` (default): A similarity-based search, retrieving documents with high vector\n     *         similarity to the query. This type prioritizes relevance and is often used when diversity\n     *         among results is less critical.\n     *       - `\"mmr\"`: Maximal Marginal Relevance search, which combines relevance with diversity. MMR\n     *         is useful for scenarios where varied content is essential, as it selects results that\n     *         both match the query and introduce content diversity.\n     *\n     *   - `filter` (optional): A filter of type `FilterType`, defined by the vector store, that allows\n     *     for refined and targeted search results. This filter applies specified conditions to limit\n     *     which documents are eligible for retrieval, offering control over the scope of results.\n     *\n     *   - `searchKwargs` (optional, applicable only if `searchType` is `\"mmr\"`): Additional settings\n     *     for configuring MMR-specific behavior. These parameters allow further tuning of the MMR\n     *     search process:\n     *       - `fetchK`: The initial number of documents fetched from the vector store before the MMR\n     *         algorithm is applied. Fetching a larger set enables the algorithm to select a more\n     *         diverse subset of documents.\n     *       - `lambda`: A parameter controlling the relevance-diversity balance, where 0 emphasizes\n     *         diversity and 1 prioritizes relevance. Intermediate values provide a blend of the two,\n     *         allowing customization based on the importance of content variety relative to query relevance.\n     */\n    constructor(fields) {\n        super(fields);\n        /**\n         * The instance of `VectorStore` used for storing and retrieving document embeddings.\n         * This vector store must implement the `VectorStoreInterface` to be compatible\n         * with the retrieverâ€™s operations.\n         */\n        Object.defineProperty(this, \"vectorStore\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        /**\n         * Specifies the number of documents to retrieve for each search query.\n         * Defaults to 4 if not specified, providing a basic result count for similarity or MMR searches.\n         */\n        Object.defineProperty(this, \"k\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 4\n        });\n        /**\n         * Determines the type of search operation to perform on the vector store.\n         *\n         * - `\"similarity\"` (default): Conducts a similarity search based purely on vector similarity\n         *   to the query.\n         * - `\"mmr\"`: Executes a maximal marginal relevance (MMR) search, balancing relevance and\n         *   diversity in the retrieved results.\n         */\n        Object.defineProperty(this, \"searchType\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"similarity\"\n        });\n        /**\n         * Additional options specific to maximal marginal relevance (MMR) search, applicable\n         * only if `searchType` is set to `\"mmr\"`.\n         *\n         * Includes:\n         * - `fetchK`: The initial number of documents fetched before applying the MMR algorithm,\n         *   allowing for a larger selection from which to choose the most diverse results.\n         * - `lambda`: A parameter between 0 and 1 to adjust the relevance-diversity balance,\n         *   where 0 prioritizes diversity and 1 prioritizes relevance.\n         */\n        Object.defineProperty(this, \"searchKwargs\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        /**\n         * Optional filter applied to search results, defined by the `FilterType` of the vector store.\n         * Allows for refined, targeted results by restricting the returned documents based\n         * on specified filter criteria.\n         */\n        Object.defineProperty(this, \"filter\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.vectorStore = fields.vectorStore;\n        this.k = fields.k ?? this.k;\n        this.searchType = fields.searchType ?? this.searchType;\n        this.filter = fields.filter;\n        if (fields.searchType === \"mmr\") {\n            this.searchKwargs = fields.searchKwargs;\n        }\n    }\n    /**\n     * Retrieves relevant documents based on the specified query, using either\n     * similarity or maximal marginal relevance (MMR) search.\n     *\n     * If `searchType` is set to `\"mmr\"`, performs an MMR search to balance\n     * similarity and diversity among results. If `searchType` is `\"similarity\"`,\n     * retrieves results purely based on similarity to the query.\n     *\n     * @param query - The query string used to find relevant documents.\n     * @param runManager - Optional callback manager for tracking retrieval progress.\n     * @returns A promise that resolves to an array of `DocumentInterface` instances\n     *          representing the most relevant documents to the query.\n     * @throws {Error} Throws an error if MMR search is requested but not supported\n     *                 by the vector store.\n     * @protected\n     */\n    async _getRelevantDocuments(query, runManager) {\n        if (this.searchType === \"mmr\") {\n            if (typeof this.vectorStore.maxMarginalRelevanceSearch !== \"function\") {\n                throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);\n            }\n            return this.vectorStore.maxMarginalRelevanceSearch(query, {\n                k: this.k,\n                filter: this.filter,\n                ...this.searchKwargs,\n            }, runManager?.getChild(\"vectorstore\"));\n        }\n        return this.vectorStore.similaritySearch(query, this.k, this.filter, runManager?.getChild(\"vectorstore\"));\n    }\n    /**\n     * Adds an array of documents to the vector store, embedding them as part of\n     * the storage process.\n     *\n     * This method delegates document embedding and storage to the `addDocuments`\n     * method of the underlying vector store.\n     *\n     * @param documents - An array of documents to embed and add to the vector store.\n     * @param options - Optional settings to customize document addition.\n     * @returns A promise that resolves to an array of document IDs or `void`,\n     *          depending on the vector store's implementation.\n     */\n    async addDocuments(documents, options) {\n        return this.vectorStore.addDocuments(documents, options);\n    }\n}\n/**\n * Abstract class representing a vector storage system for performing\n * similarity searches on embedded documents.\n *\n * `VectorStore` provides methods for adding precomputed vectors or documents,\n * removing documents based on criteria, and performing similarity searches\n * with optional scoring. Subclasses are responsible for implementing specific\n * storage mechanisms and the exact behavior of certain abstract methods.\n *\n * @abstract\n * @extends Serializable\n * @implements VectorStoreInterface\n */\nexport class VectorStore extends Serializable {\n    /**\n     * Initializes a new vector store with embeddings and database configuration.\n     *\n     * @param embeddings - Instance of `EmbeddingsInterface` used to embed queries.\n     * @param dbConfig - Configuration settings for the database or storage system.\n     */\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    constructor(embeddings, dbConfig) {\n        super(dbConfig);\n        /**\n         * Namespace within LangChain to uniquely identify this vector store's\n         * location, based on the vector store type.\n         *\n         * @internal\n         */\n        // Only ever instantiated in main LangChain\n        Object.defineProperty(this, \"lc_namespace\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: [\"langchain\", \"vectorstores\", this._vectorstoreType()]\n        });\n        /**\n         * Embeddings interface for generating vector embeddings from text queries,\n         * enabling vector-based similarity searches.\n         */\n        Object.defineProperty(this, \"embeddings\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.embeddings = embeddings;\n    }\n    /**\n     * Deletes documents from the vector store based on the specified parameters.\n     *\n     * @param _params - Flexible key-value pairs defining conditions for document deletion.\n     * @returns A promise that resolves once the deletion is complete.\n     */\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    async delete(_params) {\n        throw new Error(\"Not implemented.\");\n    }\n    /**\n     * Searches for documents similar to a text query by embedding the query and\n     * performing a similarity search on the resulting vector.\n     *\n     * @param query - Text query for finding similar documents.\n     * @param k - Number of similar results to return. Defaults to 4.\n     * @param filter - Optional filter based on `FilterType`.\n     * @param _callbacks - Optional callbacks for monitoring search progress\n     * @returns A promise resolving to an array of `DocumentInterface` instances representing similar documents.\n     */\n    async similaritySearch(query, k = 4, filter = undefined, _callbacks = undefined // implement passing to embedQuery later\n    ) {\n        const results = await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(query), k, filter);\n        return results.map((result) => result[0]);\n    }\n    /**\n     * Searches for documents similar to a text query by embedding the query,\n     * and returns results with similarity scores.\n     *\n     * @param query - Text query for finding similar documents.\n     * @param k - Number of similar results to return. Defaults to 4.\n     * @param filter - Optional filter based on `FilterType`.\n     * @param _callbacks - Optional callbacks for monitoring search progress\n     * @returns A promise resolving to an array of tuples, each containing a\n     *          document and its similarity score.\n     */\n    async similaritySearchWithScore(query, k = 4, filter = undefined, _callbacks = undefined // implement passing to embedQuery later\n    ) {\n        return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(query), k, filter);\n    }\n    /**\n     * Creates a `VectorStore` instance from an array of text strings and optional\n     * metadata, using the specified embeddings and database configuration.\n     *\n     * Subclasses must implement this method to define how text and metadata\n     * are embedded and stored in the vector store. Throws an error if not overridden.\n     *\n     * @param _texts - Array of strings representing the text documents to be stored.\n     * @param _metadatas - Metadata for the texts, either as an array (one for each text)\n     *                     or a single object (applied to all texts).\n     * @param _embeddings - Instance of `EmbeddingsInterface` to embed the texts.\n     * @param _dbConfig - Database configuration settings.\n     * @returns A promise that resolves to a new `VectorStore` instance.\n     * @throws {Error} Throws an error if this method is not overridden by a subclass.\n     */\n    static fromTexts(_texts, _metadatas, _embeddings, \n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    _dbConfig) {\n        throw new Error(\"the Langchain vectorstore implementation you are using forgot to override this, please report a bug\");\n    }\n    /**\n     * Creates a `VectorStore` instance from an array of documents, using the specified\n     * embeddings and database configuration.\n     *\n     * Subclasses must implement this method to define how documents are embedded\n     * and stored. Throws an error if not overridden.\n     *\n     * @param _docs - Array of `DocumentInterface` instances representing the documents to be stored.\n     * @param _embeddings - Instance of `EmbeddingsInterface` to embed the documents.\n     * @param _dbConfig - Database configuration settings.\n     * @returns A promise that resolves to a new `VectorStore` instance.\n     * @throws {Error} Throws an error if this method is not overridden by a subclass.\n     */\n    static fromDocuments(_docs, _embeddings, \n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    _dbConfig) {\n        throw new Error(\"the Langchain vectorstore implementation you are using forgot to override this, please report a bug\");\n    }\n    /**\n     * Creates a `VectorStoreRetriever` instance with flexible configuration options.\n     *\n     * @param kOrFields\n     *    - If a number is provided, it sets the `k` parameter (number of items to retrieve).\n     *    - If an object is provided, it should contain various configuration options.\n     * @param filter\n     *    - Optional filter criteria to limit the items retrieved based on the specified filter type.\n     * @param callbacks\n     *    - Optional callbacks that may be triggered at specific stages of the retrieval process.\n     * @param tags\n     *    - Tags to categorize or label the `VectorStoreRetriever`. Defaults to an empty array if not provided.\n     * @param metadata\n     *    - Additional metadata as key-value pairs to add contextual information for the retrieval process.\n     * @param verbose\n     *    - If `true`, enables detailed logging for the retrieval process. Defaults to `false`.\n     *\n     * @returns\n     *    - A configured `VectorStoreRetriever` instance based on the provided parameters.\n     *\n     * @example\n     * Basic usage with a `k` value:\n     * ```typescript\n     * const retriever = myVectorStore.asRetriever(5);\n     * ```\n     *\n     * Usage with a configuration object:\n     * ```typescript\n     * const retriever = myVectorStore.asRetriever({\n     *   k: 10,\n     *   filter: myFilter,\n     *   tags: ['example', 'test'],\n     *   verbose: true,\n     *   searchType: 'mmr',\n     *   searchKwargs: { alpha: 0.5 },\n     * });\n     * ```\n     */\n    asRetriever(kOrFields, filter, callbacks, tags, metadata, verbose) {\n        if (typeof kOrFields === \"number\") {\n            return new VectorStoreRetriever({\n                vectorStore: this,\n                k: kOrFields,\n                filter,\n                tags: [...(tags ?? []), this._vectorstoreType()],\n                metadata,\n                verbose,\n                callbacks,\n            });\n        }\n        else {\n            const params = {\n                vectorStore: this,\n                k: kOrFields?.k,\n                filter: kOrFields?.filter,\n                tags: [...(kOrFields?.tags ?? []), this._vectorstoreType()],\n                metadata: kOrFields?.metadata,\n                verbose: kOrFields?.verbose,\n                callbacks: kOrFields?.callbacks,\n                searchType: kOrFields?.searchType,\n            };\n            if (kOrFields?.searchType === \"mmr\") {\n                return new VectorStoreRetriever({\n                    ...params,\n                    searchKwargs: kOrFields.searchKwargs,\n                });\n            }\n            return new VectorStoreRetriever({ ...params });\n        }\n    }\n}\n/**\n * Abstract class extending `VectorStore` that defines a contract for saving\n * and loading vector store instances.\n *\n * The `SaveableVectorStore` class allows vector store implementations to\n * persist their data and retrieve it when needed.The format for saving and\n * loading data is left to the implementing subclass.\n *\n * Subclasses must implement the `save` method to handle their custom\n * serialization logic, while the `load` method enables reconstruction of a\n * vector store from saved data, requiring compatible embeddings through the\n * `EmbeddingsInterface`.\n *\n * @abstract\n * @extends VectorStore\n */\nexport class SaveableVectorStore extends VectorStore {\n    /**\n     * Loads a vector store instance from the specified directory, using the\n     * provided embeddings to ensure compatibility.\n     *\n     * This static method reconstructs a `SaveableVectorStore` from previously\n     * saved data. Implementations should interpret the saved data format to\n     * recreate the vector store instance.\n     *\n     * @param _directory - The directory path from which the vector store\n     * data will be loaded.\n     * @param _embeddings - An instance of `EmbeddingsInterface` to align\n     * the embeddings with the loaded vector data.\n     * @returns A promise that resolves to a `SaveableVectorStore` instance\n     * constructed from the saved data.\n     */\n    static load(_directory, _embeddings) {\n        throw new Error(\"Not implemented\");\n    }\n}\n", "/**\n * Returns the average of cosine distances between vectors a and b\n * @param a - first vector\n * @param b - second vector\n *\n */\nexport function cosine(a, b) {\n    let p = 0;\n    let p2 = 0;\n    let q2 = 0;\n    for (let i = 0; i < a.length; i++) {\n        p += a[i] * b[i];\n        p2 += a[i] * a[i];\n        q2 += b[i] * b[i];\n    }\n    return p / (Math.sqrt(p2) * Math.sqrt(q2));\n}\n", "/**\n * Returns the average of cosine distances between vectors a and b\n * @param a - first vector\n * @param b - second vector\n *\n */\nexport function cosine(a, b) {\n    let p = 0;\n    let p2 = 0;\n    let q2 = 0;\n    for (let i = 0; i < a.length; i++) {\n        p += a[i] * b[i];\n        p2 += a[i] * a[i];\n        q2 += b[i] * b[i];\n    }\n    return p / (Math.sqrt(p2) * Math.sqrt(q2));\n}\n", "import { cosine } from \"./ml-distance/similarities.js\";\nimport { innerProduct as innerProductDistance } from \"./ml-distance/distances.js\";\nimport { euclidean } from \"./ml-distance-euclidean/euclidean.js\";\n/**\n * Apply a row-wise function between two matrices with the same number of columns.\n *\n * @param {number[][]} X - The first matrix.\n * @param {number[][]} Y - The second matrix.\n * @param {VectorFunction} func - The function to apply.\n *\n * @throws {Error} If the number of columns in X and Y are not the same.\n *\n * @returns {number[][] | [[]]} A matrix where each row represents the result of applying the function between the corresponding rows of X and Y.\n */\nexport function matrixFunc(X, Y, func) {\n    if (X.length === 0 ||\n        X[0].length === 0 ||\n        Y.length === 0 ||\n        Y[0].length === 0) {\n        return [[]];\n    }\n    if (X[0].length !== Y[0].length) {\n        throw new Error(`Number of columns in X and Y must be the same. X has shape ${[\n            X.length,\n            X[0].length,\n        ]} and Y has shape ${[Y.length, Y[0].length]}.`);\n    }\n    return X.map((xVector) => Y.map((yVector) => func(xVector, yVector)).map((similarity) => Number.isNaN(similarity) ? 0 : similarity));\n}\nexport function normalize(M, similarity = false) {\n    const max = matrixMaxVal(M);\n    return M.map((row) => row.map((val) => (similarity ? 1 - val / max : val / max)));\n}\n/**\n * This function calculates the row-wise cosine similarity between two matrices with the same number of columns.\n *\n * @param {number[][]} X - The first matrix.\n * @param {number[][]} Y - The second matrix.\n *\n * @throws {Error} If the number of columns in X and Y are not the same.\n *\n * @returns {number[][] | [[]]} A matrix where each row represents the cosine similarity values between the corresponding rows of X and Y.\n */\nexport function cosineSimilarity(X, Y) {\n    return matrixFunc(X, Y, cosine);\n}\nexport function innerProduct(X, Y) {\n    return matrixFunc(X, Y, innerProductDistance);\n}\nexport function euclideanDistance(X, Y) {\n    return matrixFunc(X, Y, euclidean);\n}\n/**\n * This function implements the Maximal Marginal Relevance algorithm\n * to select a set of embeddings that maximizes the diversity and relevance to a query embedding.\n *\n * @param {number[]|number[][]} queryEmbedding - The query embedding.\n * @param {number[][]} embeddingList - The list of embeddings to select from.\n * @param {number} [lambda=0.5] - The trade-off parameter between relevance and diversity.\n * @param {number} [k=4] - The maximum number of embeddings to select.\n *\n * @returns {number[]} The indexes of the selected embeddings in the embeddingList.\n */\nexport function maximalMarginalRelevance(queryEmbedding, embeddingList, lambda = 0.5, k = 4) {\n    if (Math.min(k, embeddingList.length) <= 0) {\n        return [];\n    }\n    const queryEmbeddingExpanded = (Array.isArray(queryEmbedding[0]) ? queryEmbedding : [queryEmbedding]);\n    const similarityToQuery = cosineSimilarity(queryEmbeddingExpanded, embeddingList)[0];\n    const mostSimilarEmbeddingIndex = argMax(similarityToQuery).maxIndex;\n    const selectedEmbeddings = [embeddingList[mostSimilarEmbeddingIndex]];\n    const selectedEmbeddingsIndexes = [mostSimilarEmbeddingIndex];\n    while (selectedEmbeddingsIndexes.length < Math.min(k, embeddingList.length)) {\n        let bestScore = -Infinity;\n        let bestIndex = -1;\n        const similarityToSelected = cosineSimilarity(embeddingList, selectedEmbeddings);\n        similarityToQuery.forEach((queryScore, queryScoreIndex) => {\n            if (selectedEmbeddingsIndexes.includes(queryScoreIndex)) {\n                return;\n            }\n            const maxSimilarityToSelected = Math.max(...similarityToSelected[queryScoreIndex]);\n            const score = lambda * queryScore - (1 - lambda) * maxSimilarityToSelected;\n            if (score > bestScore) {\n                bestScore = score;\n                bestIndex = queryScoreIndex;\n            }\n        });\n        selectedEmbeddings.push(embeddingList[bestIndex]);\n        selectedEmbeddingsIndexes.push(bestIndex);\n    }\n    return selectedEmbeddingsIndexes;\n}\n/**\n * Finds the index of the maximum value in the given array.\n * @param {number[]} array - The input array.\n *\n * @returns {number} The index of the maximum value in the array. If the array is empty, returns -1.\n */\nfunction argMax(array) {\n    if (array.length === 0) {\n        return {\n            maxIndex: -1,\n            maxValue: NaN,\n        };\n    }\n    let maxValue = array[0];\n    let maxIndex = 0;\n    for (let i = 1; i < array.length; i += 1) {\n        if (array[i] > maxValue) {\n            maxIndex = i;\n            maxValue = array[i];\n        }\n    }\n    return { maxIndex, maxValue };\n}\nfunction matrixMaxVal(arrays) {\n    return arrays.reduce((acc, array) => Math.max(acc, argMax(array).maxValue), 0);\n}\n", "import { VectorStore, } from \"@langchain/core/vectorstores\";\nimport { Document } from \"@langchain/core/documents\";\nimport { cosine } from \"../util/ml-distance/similarities.js\";\nimport { maximalMarginalRelevance } from \"../util/math.js\";\n/**\n * In-memory, ephemeral vector store.\n *\n * Setup:\n * Install `langchain`:\n *\n * ```bash\n * npm install langchain\n * ```\n *\n * ## [Constructor args](https://api.js.langchain.com/classes/langchain.vectorstores_memory.MemoryVectorStore.html#constructor)\n *\n * <details open>\n * <summary><strong>Instantiate</strong></summary>\n *\n * ```typescript\n * import { MemoryVectorStore } from 'langchain/vectorstores/memory';\n * // Or other embeddings\n * import { OpenAIEmbeddings } from '@langchain/openai';\n *\n * const embeddings = new OpenAIEmbeddings({\n *   model: \"text-embedding-3-small\",\n * });\n *\n * const vectorStore = new MemoryVectorStore(embeddings);\n * ```\n * </details>\n *\n * <br />\n *\n * <details>\n * <summary><strong>Add documents</strong></summary>\n *\n * ```typescript\n * import type { Document } from '@langchain/core/documents';\n *\n * const document1 = { pageContent: \"foo\", metadata: { baz: \"bar\" } };\n * const document2 = { pageContent: \"thud\", metadata: { bar: \"baz\" } };\n * const document3 = { pageContent: \"i will be deleted :(\", metadata: {} };\n *\n * const documents: Document[] = [document1, document2, document3];\n *\n * await vectorStore.addDocuments(documents);\n * ```\n * </details>\n *\n * <br />\n *\n * <details>\n * <summary><strong>Similarity search</strong></summary>\n *\n * ```typescript\n * const results = await vectorStore.similaritySearch(\"thud\", 1);\n * for (const doc of results) {\n *   console.log(`* ${doc.pageContent} [${JSON.stringify(doc.metadata, null)}]`);\n * }\n * // Output: * thud [{\"baz\":\"bar\"}]\n * ```\n * </details>\n *\n * <br />\n *\n *\n * <details>\n * <summary><strong>Similarity search with filter</strong></summary>\n *\n * ```typescript\n * const resultsWithFilter = await vectorStore.similaritySearch(\"thud\", 1, { baz: \"bar\" });\n *\n * for (const doc of resultsWithFilter) {\n *   console.log(`* ${doc.pageContent} [${JSON.stringify(doc.metadata, null)}]`);\n * }\n * // Output: * foo [{\"baz\":\"bar\"}]\n * ```\n * </details>\n *\n * <br />\n *\n *\n * <details>\n * <summary><strong>Similarity search with score</strong></summary>\n *\n * ```typescript\n * const resultsWithScore = await vectorStore.similaritySearchWithScore(\"qux\", 1);\n * for (const [doc, score] of resultsWithScore) {\n *   console.log(`* [SIM=${score.toFixed(6)}] ${doc.pageContent} [${JSON.stringify(doc.metadata, null)}]`);\n * }\n * // Output: * [SIM=0.000000] qux [{\"bar\":\"baz\",\"baz\":\"bar\"}]\n * ```\n * </details>\n *\n * <br />\n *\n * <details>\n * <summary><strong>As a retriever</strong></summary>\n *\n * ```typescript\n * const retriever = vectorStore.asRetriever({\n *   searchType: \"mmr\", // Leave blank for standard similarity search\n *   k: 1,\n * });\n * const resultAsRetriever = await retriever.invoke(\"thud\");\n * console.log(resultAsRetriever);\n *\n * // Output: [Document({ metadata: { \"baz\":\"bar\" }, pageContent: \"thud\" })]\n * ```\n * </details>\n *\n * <br />\n */\nexport class MemoryVectorStore extends VectorStore {\n    _vectorstoreType() {\n        return \"memory\";\n    }\n    constructor(embeddings, { similarity, ...rest } = {}) {\n        super(embeddings, rest);\n        Object.defineProperty(this, \"memoryVectors\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: []\n        });\n        Object.defineProperty(this, \"similarity\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.similarity = similarity ?? cosine;\n    }\n    /**\n     * Method to add documents to the memory vector store. It extracts the\n     * text from each document, generates embeddings for them, and adds the\n     * resulting vectors to the store.\n     * @param documents Array of `Document` instances to be added to the store.\n     * @returns Promise that resolves when all documents have been added.\n     */\n    async addDocuments(documents) {\n        const texts = documents.map(({ pageContent }) => pageContent);\n        return this.addVectors(await this.embeddings.embedDocuments(texts), documents);\n    }\n    /**\n     * Method to add vectors to the memory vector store. It creates\n     * `MemoryVector` instances for each vector and document pair and adds\n     * them to the store.\n     * @param vectors Array of vectors to be added to the store.\n     * @param documents Array of `Document` instances corresponding to the vectors.\n     * @returns Promise that resolves when all vectors have been added.\n     */\n    async addVectors(vectors, documents) {\n        const memoryVectors = vectors.map((embedding, idx) => ({\n            content: documents[idx].pageContent,\n            embedding,\n            metadata: documents[idx].metadata,\n            id: documents[idx].id,\n        }));\n        this.memoryVectors = this.memoryVectors.concat(memoryVectors);\n    }\n    async _queryVectors(query, k, filter) {\n        const filterFunction = (memoryVector) => {\n            if (!filter) {\n                return true;\n            }\n            const doc = new Document({\n                metadata: memoryVector.metadata,\n                pageContent: memoryVector.content,\n                id: memoryVector.id,\n            });\n            return filter(doc);\n        };\n        const filteredMemoryVectors = this.memoryVectors.filter(filterFunction);\n        return filteredMemoryVectors\n            .map((vector, index) => ({\n            similarity: this.similarity(query, vector.embedding),\n            index,\n            metadata: vector.metadata,\n            content: vector.content,\n            embedding: vector.embedding,\n            id: vector.id,\n        }))\n            .sort((a, b) => (a.similarity > b.similarity ? -1 : 0))\n            .slice(0, k);\n    }\n    /**\n     * Method to perform a similarity search in the memory vector store. It\n     * calculates the similarity between the query vector and each vector in\n     * the store, sorts the results by similarity, and returns the top `k`\n     * results along with their scores.\n     * @param query Query vector to compare against the vectors in the store.\n     * @param k Number of top results to return.\n     * @param filter Optional filter function to apply to the vectors before performing the search.\n     * @returns Promise that resolves with an array of tuples, each containing a `Document` and its similarity score.\n     */\n    async similaritySearchVectorWithScore(query, k, filter) {\n        const searches = await this._queryVectors(query, k, filter);\n        const result = searches.map((search) => [\n            new Document({\n                metadata: search.metadata,\n                pageContent: search.content,\n                id: search.id,\n            }),\n            search.similarity,\n        ]);\n        return result;\n    }\n    async maxMarginalRelevanceSearch(query, options) {\n        const queryEmbedding = await this.embeddings.embedQuery(query);\n        const searches = await this._queryVectors(queryEmbedding, options.fetchK ?? 20, options.filter);\n        const embeddingList = searches.map((searchResp) => searchResp.embedding);\n        const mmrIndexes = maximalMarginalRelevance(queryEmbedding, embeddingList, options.lambda, options.k);\n        return mmrIndexes.map((idx) => new Document({\n            metadata: searches[idx].metadata,\n            pageContent: searches[idx].content,\n            id: searches[idx].id,\n        }));\n    }\n    /**\n     * Static method to create a `MemoryVectorStore` instance from an array of\n     * texts. It creates a `Document` for each text and metadata pair, and\n     * adds them to the store.\n     * @param texts Array of texts to be added to the store.\n     * @param metadatas Array or single object of metadata corresponding to the texts.\n     * @param embeddings `Embeddings` instance used to generate embeddings for the texts.\n     * @param dbConfig Optional `MemoryVectorStoreArgs` to configure the `MemoryVectorStore` instance.\n     * @returns Promise that resolves with a new `MemoryVectorStore` instance.\n     */\n    static async fromTexts(texts, metadatas, embeddings, dbConfig) {\n        const docs = [];\n        for (let i = 0; i < texts.length; i += 1) {\n            const metadata = Array.isArray(metadatas) ? metadatas[i] : metadatas;\n            const newDoc = new Document({\n                pageContent: texts[i],\n                metadata,\n            });\n            docs.push(newDoc);\n        }\n        return MemoryVectorStore.fromDocuments(docs, embeddings, dbConfig);\n    }\n    /**\n     * Static method to create a `MemoryVectorStore` instance from an array of\n     * `Document` instances. It adds the documents to the store.\n     * @param docs Array of `Document` instances to be added to the store.\n     * @param embeddings `Embeddings` instance used to generate embeddings for the documents.\n     * @param dbConfig Optional `MemoryVectorStoreArgs` to configure the `MemoryVectorStore` instance.\n     * @returns Promise that resolves with a new `MemoryVectorStore` instance.\n     */\n    static async fromDocuments(docs, embeddings, dbConfig) {\n        const instance = new this(embeddings, dbConfig);\n        await instance.addDocuments(docs);\n        return instance;\n    }\n    /**\n     * Static method to create a `MemoryVectorStore` instance from an existing\n     * index. It creates a new `MemoryVectorStore` instance without adding any\n     * documents or vectors.\n     * @param embeddings `Embeddings` instance used to generate embeddings for the documents.\n     * @param dbConfig Optional `MemoryVectorStoreArgs` to configure the `MemoryVectorStore` instance.\n     * @returns Promise that resolves with a new `MemoryVectorStore` instance.\n     */\n    static async fromExistingIndex(embeddings, dbConfig) {\n        const instance = new this(embeddings, dbConfig);\n        return instance;\n    }\n}\n"],
  "mappings": "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",
  "names": ["cosine", "cosine"]
}
